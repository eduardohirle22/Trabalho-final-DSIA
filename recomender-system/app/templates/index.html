<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Recommender | Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

    <nav class="app-sidebar">
        <div class="sidebar-header">
            <span class="material-icons-round">analytics</span>
            RecSys.io
        </div>
        
        <div class="sidebar-nav">
            <a href="#" class="nav-item active">
                <span class="material-icons-round">dashboard</span>
                Dashboard
            </a>
        </div>

        <div class="sidebar-footer">
            v1.0.0-stable<br>
            Docker Container Active
        </div>
    </nav>

    <main class="app-main">
        
        <header class="app-header">
            <div class="header-title">
                <h2>Dashboard de Recomendação</h2>
                <p>Gerenciamento de modelo e endpoints de inferência</p>
            </div>
            </header>

        <div class="content-scroll">
            <div class="dashboard-grid">

                <div class="card">
                    <div class="card-header">
                        <div class="header-label"><span class="material-icons-round">star_rate</span> Top Rated</div>
                    </div>
                    <div class="card-body">
                        <p style="font-size: 0.9rem; color: var(--color-text-muted);">Listar itens com maior score médio.</p>
                        <button onclick="getBestRated()">Carregar Relatório</button>
                        <div class="output-container">
                            <span class="output-label">JSON Output</span>
                            <pre id="best-rated">{}</pre>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="header-label"><span class="material-icons-round">trending_up</span> Most Viewed</div>
                    </div>
                    <div class="card-body">
                        <p style="font-size: 0.9rem; color: var(--color-text-muted);">Itens com maior volume de interações.</p>
                        <button onclick="getMostViewed()" class="btn-outline">Carregar Dados</button>
                        <div class="output-container">
                            <span class="output-label">JSON Output</span>
                            <pre id="most-viewed">{}</pre>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="header-label"><span class="material-icons-round">hub</span> Engine de Similaridade</div>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Target Movie ID</label>
                            <input type="number" id="similar-movie-id" placeholder="Ex: 1024">
                        </div>
                        <button onclick="getSimilar()">Executar Item-based</button>
                        <div class="output-container">
                            <pre id="similar">Waiting for input...</pre>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="header-label"><span class="material-icons-round">person_search</span> User Inference</div>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>User ID</label>
                            <input type="number" id="user-id" placeholder="Ex: 88">
                        </div>
                        <button onclick="getUserBased()">Predict Recommendations</button>
                        <div class="output-container">
                            <pre id="user-based">Waiting for input...</pre>
                        </div>
                    </div>
                </div>

                <div class="card full-width">
                    <div class="card-header">
                        <div class="header-label"><span class="material-icons-round">add_circle</span> Ingestão de Dados</div>
                    </div>
                    <div class="card-body">
                        <div class="form-row">
                            <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                                <label>Registrar Usuário</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="number" id="new-user-id" placeholder="Novo ID">
                                    <button onclick="addUser()">POST</button>
                                </div>
                                <div class="output-container">
                                    <pre id="add-user">Status: Idle</pre>
                                </div>
                            </div>
                            
                            <div style="width: 1px; background: var(--color-border);"></div>

                            <div style="flex: 2; display: flex; flex-direction: column; gap: 10px;">
                                <label>Registrar Filme</label>
                                <div class="form-row">
                                    <input type="number" id="new-movie-id" placeholder="ID" style="width: 80px;">
                                    <input type="text" id="new-movie-title" placeholder="Título do Filme" style="flex: 1;">
                                    <input type="text" id="new-movie-genre" placeholder="Gênero" style="width: 150px;">
                                </div>
                                <button onclick="addMovie()">Salvar no Banco Vetorial</button>
                                <div class="output-container">
                                    <pre id="add-movie">Status: Idle</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card full-width">
                    <div class="card-header">
                        <div class="header-label"><span class="material-icons-round">rate_review</span> Atualizar Feedback (Loop de Treino)</div>
                    </div>
                    <div class="card-body">
                        <div class="form-row" style="align-items: flex-end;">
                            <div class="form-group" style="flex: 1;">
                                <label>User ID</label>
                                <input type="number" id="rating-user-id">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label>Movie ID</label>
                                <input type="number" id="rating-movie-id">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label>Score (0.0 - 5.0)</label>
                                <input type="number" step="0.5" id="rating-value">
                            </div>
                            <button onclick="updateRating()" style="height: 42px;">Enviar Feedback</button>
                        </div>
                        <div class="output-container">
                            <pre id="rating-update">Aguardando submissão...</pre>
                        </div>
                    </div>
                </div>

            </div>
            
            <footer style="margin-top: 3rem; text-align: center; color: var(--color-text-muted); font-size: 0.8rem;">
                &copy; 2025 Recommender System Enterprise Edition. All rights reserved.
            </footer>
        </div>
    </main>

    <script>
        async function getBestRated() { try { let res = await fetch("/best-seller/ratings/"); document.getElementById("best-rated").textContent = JSON.stringify(await res.json(), null, 2); } catch (e) { document.getElementById("best-rated").textContent = "Erro/Offline"; } }
        async function getMostViewed() { try { let res = await fetch("/best-seller/views/"); document.getElementById("most-viewed").textContent = JSON.stringify(await res.json(), null, 2); } catch (e) { document.getElementById("most-viewed").textContent = "Erro/Offline"; } }
        async function getSimilar() { try { let movieId = document.getElementById("similar-movie-id").value; let res = await fetch(`/similarity/${movieId}`); document.getElementById("similar").textContent = JSON.stringify(await res.json(), null, 2); } catch (e) { document.getElementById("similar").textContent = "Erro ID"; } }
        async function getUserBased() { try { let userId = document.getElementById("user-id").value; let res = await fetch(`/user-based/${userId}`); document.getElementById("user-based").textContent = JSON.stringify(await res.json(), null, 2); } catch (e) { document.getElementById("user-based").textContent = "Erro ID"; } }
        async function addUser() { let id = document.getElementById("new-user-id").value; let res = await fetch("/users/", { method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify({ user_id: Number(id) }) }); document.getElementById("add-user").textContent = JSON.stringify(await res.json(), null, 2); }
        async function addMovie() { let id = Number(document.getElementById("new-movie-id").value); let title = document.getElementById("new-movie-title").value; let genre = document.getElementById("new-movie-genre").value; let res = await fetch("/movies/", { method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify({ movieId: id, title: title, genres: genre }) }); document.getElementById("add-movie").textContent = JSON.stringify(await res.json(), null, 2); }
        async function updateRating() { let userId = Number(document.getElementById("rating-user-id").value); let movieId = Number(document.getElementById("rating-movie-id").value); let rating = Number(document.getElementById("rating-value").value); let res = await fetch("/ratings/", { method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify({ user_id: userId, movie_id: movieId, rating: rating }) }); document.getElementById("rating-update").textContent = JSON.stringify(await res.json(), null, 2); }
    </script>
</body>
</html>
